<!DOCTYPE html>
<html>
	<head>
		<title>
			Running App / Game
		</title>
		
		<style>
			h1 {
				font-family: arial;
			}
		</style>
	</head>
	
	<body>
		<header>
			<h1>
				Running Game
			</h1>
		</header>
		
		<section>
			<h2>
				Load Save
			</h2>
			
			<br/>
			
			<input id="saveSelect" type="file"></input>
			
			<br/>
			
			<br/>
			
			<button onclick="loadSave()">
				Load Save
			</button>
			
			<br/>
			
			<br/>
			
			<br/>
			
			<h2>
				Start New Save
			</h2>
			
			<button onclick="newGame()">
				New Save
			</button>
		</section>
		 
		<script>
			//do nothing
			
			//global variables 
			var name = "";
			var save = "";
			
			//new game function 
			function newGame(){
				//go to form creation
				goToFormCreation();
			};
			
			//go to menu
			function goToFormCreation(){
				//reset inner html 
				document.body.innerHTML = "<header><h1>Create Account:</h1></header><br/><h2>What is your name?</h2><br/><input id=\"nameInput\"></input><br/><br/><button onclick=\"createSave()\">Create Account</button>";
			};
			
			//filter name
			function filterName(nameToFilter){
				let tempName = "";
				
				for(let i = 0; i < nameToFilter.length; i++){
					if(nameToFilter[i] != "|"){
						tempName += nameToFilter[i];
					};
				};
				
				return tempName;
			};
			
			//loadSave
			function loadSave(){
				//create file reader 
				if(document.getElementById("saveSelect").files.length > 0){
					var reader = new FileReader();
					reader.readAsText(document.getElementById("saveSelect").files[0]);
					
					reader.onload = ()=>{
						//set save 
						save = reader.result;
						
						//set name 
						name = save.substring(0,save.indexOf("|"));
						
						//proceed 
						goToMenu();
					};
				} else {
					alert("You have not selected a file!");
				};
				
				//load save 
				//console.log(document.getElementById("saveSelect").files);
			};			
			
			//create save 
			function createSave(){
				//create save
				if(name == ""){
					name = document.getElementById("nameInput").value;
				};
				
				if(name == "" || name.length < 1){
					//error has occured 
					alert("Please enter a name");
					goToFormCreation();
				};
				
				let fileString = name + "|0";
				let fileName = name + ".runSave";
				
				var download = document.createElement("a");
				download.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(fileString));
				download.setAttribute("download", fileName);
				download.style.display = "none";
				document.body.appendChild(download);
				download.click();
				document.body.removeChild(download);
				
				//go to menu 
				goToMenu();
			};
			
			//go to menu 
			function goToMenu(){
				//change innerHTML
				document.body.innerHTML = "<header><h1>Welcome " + name + "!</h1></header>";
			};
		</script>
	</body>
</html>